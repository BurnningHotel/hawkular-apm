{
  "instrumentation": {
    "camel": {
      "description": "Camel instrumentation",
      "version": "1",
      "rules": [{
        "ruleName": "Camel Inbound Component Start",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeCreated",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange"
        ],
        "location": "ENTRY",
        "condition": "!isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.seda.SedaEndpoint.class)",
        "actions": [{
          "type": "InstrumentComponent",
          "direction": "Request",
          "componentTypeExpression": "removeSuffix(simpleClassName($2.getFromEndpoint()),\"Endpoint\")",
          "uriExpression": "$2.getFromEndpoint().getEndpointUri()"
        }]
      },{
        "ruleName": "Camel Inbound Component End",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeDone",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange"
        ],
        "location": "ENTRY",
        "condition": "!isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.seda.SedaEndpoint.class)",
        "actions": [{
          "type": "InstrumentComponent",
          "direction": "Response",
          "componentTypeExpression": "removeSuffix(simpleClassName($2.getFromEndpoint()),\"Endpoint\")",
          "uriExpression": "$2.getFromEndpoint().getEndpointUri()"
        }]
      },{
        "ruleName": "Camel Outbound Component Start",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeSending",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange",
           "org.apache.camel.Endpoint"
        ],
        "location": "ENTRY",
        "condition": "!isInstanceOf($3,org.apache.camel.component.seda.SedaEndpoint.class)",
        "actions": [{
          "type": "InstrumentComponent",
          "direction": "Request",
          "componentTypeExpression": "removeSuffix(simpleClassName($3),\"Endpoint\")",
          "uriExpression": "$3.getEndpointUri()"
        }]
      },{
        "ruleName": "Camel Outbound Component End",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeSent",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange",
           "org.apache.camel.Endpoint",
           "long"
        ],
        "location": "ENTRY",
        "condition": "!isInstanceOf($3,org.apache.camel.component.seda.SedaEndpoint.class)",
        "actions": [{
          "type": "InstrumentComponent",
          "direction": "Response",
          "componentTypeExpression": "removeSuffix(simpleClassName($3),\"Endpoint\")",
          "uriExpression": "$3.getEndpointUri()"
        }]
      },{
        "ruleName": "Camel Inbound Consumer Start",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeCreated",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange"
        ],
        "location": "ENTRY",
        "condition": "isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.seda.SedaEndpoint.class)",
        "actions": [{
          "type": "InstrumentConsumer",
          "direction": "Request",
          "endpointTypeExpression": "removeSuffix(simpleClassName($2.getFromEndpoint()),\"Endpoint\")",
          "uriExpression": "$2.getFromEndpoint().getEndpointUri()",
          "idExpression": "$2.getProperty(\"btmid\")"
        },{
          "type": "FreeFormAction",
          "action": "$2.removeProperty(\"btmid\")"
        }]
      },{
        "ruleName": "Camel Inbound Consumer End",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeDone",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange"
        ],
        "location": "ENTRY",
        "condition": "isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.seda.SedaEndpoint.class)",
        "actions": [{
          "type": "InstrumentConsumer",
          "direction": "Response",
          "endpointTypeExpression": "removeSuffix(simpleClassName($2.getFromEndpoint()),\"Endpoint\")",
          "uriExpression": "$2.getFromEndpoint().getEndpointUri()"
        }]
      },{
        "ruleName": "Camel Outbound Producer Start",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeSending",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange",
           "org.apache.camel.Endpoint"
        ],
        "location": "ENTRY",
        "binds": [{
          "name": "id",
          "type": "java.lang.String",
          "expression": "createUUID()"
        }],
        "condition": "isInstanceOf($3,org.apache.camel.component.seda.SedaEndpoint.class)",
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Request",
          "endpointTypeExpression": "removeSuffix(simpleClassName($3),\"Endpoint\")",
          "uriExpression": "$3.getEndpointUri()",
          "idExpression": "id"
        },{
          "type": "FreeFormAction",
          "action": "$2.setProperty(\"btmid\",id)"
        }]
      },{
        "ruleName": "Camel Outbound Producer End",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeSent",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange",
           "org.apache.camel.Endpoint",
           "long"
        ],
        "location": "ENTRY",
        "condition": "isInstanceOf($3,org.apache.camel.component.seda.SedaEndpoint.class)",
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Response",
          "endpointTypeExpression": "removeSuffix(simpleClassName($3),\"Endpoint\")",
          "uriExpression": "$3.getEndpointUri()"
        }]
      }]
    },
    "restlet": {
      "description": "Restlet instrumentation",
      "version": "1",
      "rules": [{
        "ruleName": "Restlet Async Consumer Start",
        "className": "org.restlet.Server",
        "methodName": "handle",
        "parameterTypes": [
          "org.restlet.Request",
          "org.restlet.Response"
        ],
        "location": "ENTRY",
        "binds": [{
          "name": "headers",
          "type": "org.restlet.util.Series",
          "expression": "$1.getAttributes().get(\"org.restlet.http.headers\")"
        },{
          "name": "id",
          "type": "java.lang.String",
          "expression": "headers.getFirstValue(\"Btmid\")"
        }],
        "actions": [{
          "type": "FreeFormAction",
          "action": "headers.removeAll(\"Btmid\")"
        },{
          "type": "InstrumentConsumer",
          "direction": "Request",
          "endpointTypeExpression": "\"REST\"",
          "uriExpression": "$1.getResourceRef()",
          "idExpression": "id",
          "headersExpression": "headers.getValuesMap()"
        }]
      },{
        "ruleName": "Restlet Async Consumer End",
        "className": "org.restlet.Server",
        "methodName": "handle",
        "parameterTypes": [
           "org.restlet.Request",
           "org.restlet.Response"
        ],
        "location": "EXIT",
        "binds": [{
          "name": "headers",
          "type": "org.restlet.util.Series",
          "expression": "$2.getAttributes().get(\"org.restlet.http.headers\")"
        }],
        "actions": [{
          "type": "InstrumentConsumer",
          "direction": "Response",
          "endpointTypeExpression": "\"REST\"",
          "uriExpression": "$1.getResourceRef()",
          "headersExpression": "headers.getValuesMap()"
        }]
      },{
        "ruleName": "Restlet Async Producer Start",
        "className": "org.restlet.Restlet",
        "methodName": "handle",
        "parameterTypes": [
           "org.restlet.Request",
           "org.restlet.Uniform"
        ],
        "location": "ENTRY",
        "binds": [{
          "name": "headers",
          "type": "org.restlet.util.Series",
          "expression": "$1.getAttributes().get(\"org.restlet.http.headers\")"
        },{
          "name": "id",
          "type": "java.lang.String",
          "expression": "createUUID()"
        }],
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Request",
          "endpointTypeExpression": "\"REST\"",
          "uriExpression": "$1.getResourceRef()",
          "idExpression": "id",
          "headersExpression": "headers.getValuesMap()"
        },{
          "type": "FreeFormAction",
          "action": "headers.set(\"Btmid\",id)"
        }]
      },{
        "ruleName": "Restlet Async Producer End",
        "interfaceName": "^org.restlet.Uniform",
        "methodName": "handle",
        "parameterTypes": [
           "org.restlet.Request",
           "org.restlet.Response"
        ],
        "location": "ENTRY",
        "binds": [{
          "name": "headers",
          "type": "org.restlet.util.Series",
          "expression": "$2.getAttributes().get(\"org.restlet.http.headers\")"
        }],
        "condition": "callerEquals(\"ClientAdapter$1.handle\", true)",
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Response",
          "endpointTypeExpression": "\"REST\"",
          "uriExpression": "$1.getResourceRef()",
          "headersExpression": "headers.getValuesMap()"
        }]
      }]
    },
    "jms": {
      "description": "JMS instrumentation",
      "version": "1",
      "rules": [{
        "ruleName": "JMS Consumer Start",
        "interfaceName": "^javax.jms.MessageListener",
        "methodName": "onMessage",
        "parameterTypes": [
          "javax.jms.Message"
        ],
        "location": "ENTRY",
        "condition": "!isInstanceOf($1.getJMSDestination(),javax.jms.TemporaryQueue.class)",
        "actions": [{
          "type": "InstrumentConsumer",
          "direction": "Request",
          "endpointTypeExpression": "\"JMS\"",
          "uriExpression": "$1.getJMSDestination()",
          "idExpression": "$1.getJMSMessageID()"
        }]
      },{
        "ruleName": "JMS Consumer End",
        "interfaceName": "^javax.jms.MessageListener",
        "methodName": "onMessage",
        "parameterTypes": [
          "javax.jms.Message"
        ],
        "location": "EXIT",
        "condition": "!isInstanceOf($1.getJMSDestination(),javax.jms.TemporaryQueue.class)",
        "actions": [{
          "type": "InstrumentConsumer",
          "direction": "Response",
          "endpointTypeExpression": "\"JMS\"",
          "uriExpression": "$1.getJMSDestination()"
        },{
          "type": "FreeFormAction",
          "action": "collector().session().assertComplete()"
        }]
      },{
        "ruleName": "JMS Producer Sync Start",
        "interfaceName": "^javax.jms.MessageProducer",
        "methodName": "send",
        "parameterTypes": [
          "javax.jms.Destination",
          "javax.jms.Message",
          "int",
          "int",
          "long"
        ],
        "location": "ENTRY",
        "condition": "$2.getJMSReplyTo() == null",
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Request",
          "endpointTypeExpression": "\"JMS\"",
          "uriExpression": "$1"
        },{
          "type": "FreeFormAction",
          "action": "collector().session().retainNode(\"jmsProducer\")"
        }]
      },{
        "ruleName": "JMS Producer Start",
        "interfaceName": "^javax.jms.MessageProducer",
        "methodName": "send",
        "parameterTypes": [
          "javax.jms.Destination",
          "javax.jms.Message",
          "int",
          "int",
          "long"
        ],
        "location": "ENTRY",
        "condition": "$2.getJMSReplyTo() != null && !isInstanceOf($1,javax.jms.TemporaryQueue.class)",
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Request",
          "endpointTypeExpression": "\"JMS\"",
          "uriExpression": "$1"
        },{
          "type": "FreeFormAction",
          "action": "collector().session().retainNode(\"jmsProducer\")"
        },{
          "type": "FreeFormAction",
          "action": "collector().session().initiateLink($2.getJMSReplyTo())"
        }]
      },{
        "ruleName": "JMS Producer Sync End",
        "interfaceName": "^javax.jms.MessageProducer",
        "methodName": "send",
        "parameterTypes": [
          "javax.jms.Destination",
          "javax.jms.Message",
          "int",
          "int",
          "long"
        ],
        "location": "EXIT",
        "condition": "$2.getJMSReplyTo() == null",
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Response",
          "endpointTypeExpression": "\"JMS\"",
          "uriExpression": "$1"
        }]
      },{
        "ruleName": "JMS Producer Async End",
        "interfaceName": "^javax.jms.MessageListener",
        "methodName": "onMessage",
        "parameterTypes": [
          "javax.jms.Message"
        ],
        "location": "ENTRY",
        "condition": "isInstanceOf($1.getJMSDestination(),javax.jms.TemporaryQueue.class)",
        "actions": [{
          "type": "FreeFormAction",
          "action": "collector().session().completeLink($1.getJMSDestination())"
        },{
          "type": "InstrumentProducer",
          "direction": "Response",
          "endpointTypeExpression": "\"JMS\""
        }]
      },{
        "ruleName": "JMS Producer Async Response Thread Complete",
        "interfaceName": "^javax.jms.MessageListener",
        "methodName": "onMessage",
        "parameterTypes": [
          "javax.jms.Message"
        ],
        "location": "EXIT",
        "condition": "isInstanceOf($1.getJMSDestination(),javax.jms.TemporaryQueue.class)",
        "actions": [{
          "type": "FreeFormAction",
          "action": "collector().session().unlink()"
        }]
      },{
        "ruleName": "JMS Producer Set Identifier",
        "interfaceName": "^javax.jms.MessageProducer",
        "methodName": "send",
        "parameterTypes": [
          "javax.jms.Destination",
          "javax.jms.Message",
          "int",
          "int",
          "long"
        ],
        "location": "EXIT",
        "condition": "!isInstanceOf($1,javax.jms.TemporaryQueue.class)",
        "actions": [{
          "type": "FreeFormAction",
          "action": "collector().session().retrieveNode(\"jmsProducer\").addInteractionId($2.getJMSMessageID())"
        },{
          "type": "FreeFormAction",
          "action": "collector().session().releaseNode(\"jmsProducer\")"
        }]
      }]
    }
  }
}