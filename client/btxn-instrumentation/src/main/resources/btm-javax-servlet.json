{
  "instrumentation": {
    "javax-servlet": {
      "description": "Javax Servlet instrumentation",
      "version": "1",
      "rules": [{
        "ruleName": "Javax Servlet Consumer Start",
        "interfaceName": "^javax.servlet.Servlet",
        "methodName": "service",
        "parameterTypes": [
          "javax.servlet.ServletRequest",
          "javax.servlet.ServletResponse"
        ],
        "location": "ENTRY",
        "binds": [{
          "name": "req",
          "type": "javax.servlet.http.HttpServletRequest",
          "expression": "$1"
        }],
        "condition": "collector().session().activate(req.getRequestURL().toString(),req.getHeader(\"Hawkular-btm\"))",
        "actions": [{
          "type": "InstrumentConsumer",
          "direction": "Request",
          "endpointTypeExpression": "\"HTTP\"",
          "uriExpression": "req.getRequestURL().toString()",
          "headersExpression": "getHeaders(\"javax.servlet.http.HttpServletRequest\",req)",
          "idExpression": "req.getHeader(\"Hawkular-btm\")"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"btm_source\",\"javax-servlet\")"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"principal\",req.getRemoteUser())"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"remoteAddr\",req.getRemoteAddr())"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"remoteHost\",req.getRemoteHost())"
        }]
      },{
        "ruleName": "Javax Servlet Consumer End",
        "interfaceName": "^javax.servlet.Servlet",
        "methodName": "service",
        "parameterTypes": [
          "javax.servlet.ServletRequest",
          "javax.servlet.ServletResponse"
        ],
        "location": "EXIT",
        "binds": [{
          "name": "req",
          "type": "javax.servlet.http.HttpServletRequest",
          "expression": "$1"
        }],
        "condition": "collector().session().isActive()",
        "actions": [{
          "type": "InstrumentConsumer",
          "direction": "Response",
          "endpointTypeExpression": "\"HTTP\"",
          "uriExpression": "req.getRequestURL().toString()"
        }]
      }]
    }
  }
}