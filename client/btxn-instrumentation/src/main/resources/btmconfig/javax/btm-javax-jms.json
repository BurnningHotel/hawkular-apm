{
  "instrumentation": {
    "javax.jms": {
      "description": "Javax JMS instrumentation",
      "rules": [{
        "ruleName": "JMS Consumer Start",
        "interfaceName": "^javax.jms.MessageListener",
        "methodName": "onMessage",
        "parameterTypes": [
          "javax.jms.Message"
        ],
        "location": "ENTRY",
        "condition": "!isInstanceOf($1.getJMSDestination(),javax.jms.TemporaryQueue.class) && collector().session().activate($1.getJMSDestination(),$1.getStringProperty(\"HawkularBTID\"))",
        "actions": [{
          "type": "InstrumentConsumer",
          "direction": "Request",
          "endpointTypeExpression": "\"MOM\"",
          "uriExpression": "$1.getJMSDestination()",
          "headersExpression": "getHeaders(\"javax.jms.Message\",$1)",
          "idExpression": "$1.getStringProperty(\"HawkularBTID\")"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"btm_source\",\"javax.jms\")"
        },{
          "type": "FreeFormAction",
          "action": "collector().setName($1.getStringProperty(\"HawkularBTName\"))"
        }]
      },{
        "ruleName": "Javax JMS Consumer End",
        "interfaceName": "^javax.jms.MessageListener",
        "methodName": "onMessage",
        "parameterTypes": [
          "javax.jms.Message"
        ],
        "location": "EXIT",
        "condition": "!isInstanceOf($1.getJMSDestination(),javax.jms.TemporaryQueue.class) && collector().session().isActive()",
        "actions": [{
          "type": "InstrumentConsumer",
          "direction": "Response",
          "endpointTypeExpression": "\"MOM\"",
          "uriExpression": "$1.getJMSDestination()"
        },{
          "type": "FreeFormAction",
          "action": "collector().session().assertComplete()"
        }]
      },{
        "ruleName": "Javax JMS Producer Sync Start",
        "interfaceName": "^javax.jms.MessageProducer",
        "methodName": "send",
        "parameterTypes": [
          "javax.jms.Destination",
          "javax.jms.Message",
          "int",
          "int",
          "long"
        ],
        "location": "ENTRY",
        "condition": "$2.getJMSReplyTo() == null && collector().session().activate($1)",
        "binds": [{
          "name": "id",
          "type": "java.lang.String",
          "expression": "createUUID()"
        }],
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Request",
          "endpointTypeExpression": "\"MOM\"",
          "headersExpression": "getHeaders(\"javax.jms.Message\",$2)",
          "idExpression": "id",
          "uriExpression": "$1"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"btm_source\",\"javax.jms\")"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"btm_publish\",isInstanceOf($1,javax.jms.Topic.class))"
        },{
          "type": "FreeFormAction",
          "action": "$2.setStringProperty(\"HawkularBTID\",id)"
        },{
          "type": "FreeFormAction",
          "action": "$2.setStringProperty(\"HawkularBTName\",collector().getName())"
        }]
      },{
        "ruleName": "Javax JMS Producer Async Start",
        "interfaceName": "^javax.jms.MessageProducer",
        "methodName": "send",
        "parameterTypes": [
          "javax.jms.Destination",
          "javax.jms.Message",
          "int",
          "int",
          "long"
        ],
        "location": "ENTRY",
        "condition": "$2.getJMSReplyTo() != null && !isInstanceOf($1,javax.jms.TemporaryQueue.class) && collector().session().activate($1)",
        "binds": [{
          "name": "id",
          "type": "java.lang.String",
          "expression": "createUUID()"
        }],
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Request",
          "endpointTypeExpression": "\"MOM\"",
          "headersExpression": "getHeaders(\"javax.jms.Message\",$2)",
          "idExpression": "id",
          "uriExpression": "$1"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"btm_source\",\"javax.jms\")"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"btm_publish\",isInstanceOf($1,javax.jms.Topic.class))"
        },{
          "type": "FreeFormAction",
          "action": "collector().session().initiateLink($2.getJMSReplyTo())"
        },{
          "type": "FreeFormAction",
          "action": "$2.setStringProperty(\"HawkularBTID\",id)"
        },{
          "type": "FreeFormAction",
          "action": "$2.setStringProperty(\"HawkularBTName\",collector().getName())"
        }]
      },{
        "ruleName": "Javax JMS Producer Sync End",
        "interfaceName": "^javax.jms.MessageProducer",
        "methodName": "send",
        "parameterTypes": [
          "javax.jms.Destination",
          "javax.jms.Message",
          "int",
          "int",
          "long"
        ],
        "location": "EXIT",
        "condition": "$2.getJMSReplyTo() == null && collector().session().isActive()",
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Response",
          "endpointTypeExpression": "\"MOM\"",
          "uriExpression": "$1"
        }]
      },{
        "ruleName": "Javax JMS Producer Async End",
        "interfaceName": "^javax.jms.MessageListener",
        "methodName": "onMessage",
        "parameterTypes": [
          "javax.jms.Message"
        ],
        "location": "ENTRY",
        "condition": "isInstanceOf($1.getJMSDestination(),javax.jms.TemporaryQueue.class) && collector().session().isLinkActive($1.getJMSDestination())",
        "actions": [{
          "type": "FreeFormAction",
          "action": "collector().session().completeLink($1.getJMSDestination())"
        },{
          "type": "InstrumentProducer",
          "direction": "Response",
          "endpointTypeExpression": "\"MOM\""
        }]
      },{
        "ruleName": "Javax JMS Producer Async Response Thread Complete",
        "interfaceName": "^javax.jms.MessageListener",
        "methodName": "onMessage",
        "parameterTypes": [
          "javax.jms.Message"
        ],
        "location": "EXIT",
        "condition": "isInstanceOf($1.getJMSDestination(),javax.jms.TemporaryQueue.class) && collector().session().isActive()",
        "actions": [{
          "type": "FreeFormAction",
          "action": "collector().session().unlink()"
        }]
      }]
    }
  }
}