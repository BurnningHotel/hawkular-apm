{
  "instrumentation": {
    "org.restlet": {
      "description": "Restlet instrumentation",
      "rules": [{
        "ruleName": "Restlet Async Consumer Start",
        "className": "org.restlet.Server",
        "methodName": "handle",
        "parameterTypes": [
          "org.restlet.Request",
          "org.restlet.Response"
        ],
        "location": "ENTRY",
        "binds": [{
          "name": "headers",
          "type": "org.restlet.util.Series",
          "expression": "$1.getAttributes().get(\"org.restlet.http.headers\")"
        },{
          "name": "id",
          "type": "java.lang.String",
          "expression": "headers.getFirstValue(\"Hawkular-btid\")"
        },{
          "name": "btname",
          "type": "java.lang.String",
          "expression": "headers.getFirstValue(\"Hawkular-btname\")"
        }],
        "condition": "collector().session().activate($1.getResourceRef(),id)",
        "actions": [{
          "type": "FreeFormAction",
          "action": "headers.removeAll(\"Hawkular-btid\")"
        },{
          "type": "FreeFormAction",
          "action": "collector().setName(btname)"
        },{
          "type": "InstrumentConsumer",
          "direction": "Request",
          "endpointTypeExpression": "\"HTTP\"",
          "uriExpression": "$1.getResourceRef()",
          "idExpression": "id",
          "headersExpression": "headers.getValuesMap()"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"btm_source\",\"org.restlet\")"
        }]
      },{
        "ruleName": "Restlet Async Consumer End",
        "className": "org.restlet.Server",
        "methodName": "handle",
        "parameterTypes": [
           "org.restlet.Request",
           "org.restlet.Response"
        ],
        "location": "EXIT",
        "binds": [{
          "name": "headers",
          "type": "org.restlet.util.Series",
          "expression": "$2.getAttributes().get(\"org.restlet.http.headers\")"
        }],
        "condition": "collector().session().isActive()",
        "actions": [{
          "type": "InstrumentConsumer",
          "direction": "Response",
          "endpointTypeExpression": "\"HTTP\"",
          "uriExpression": "$1.getResourceRef()",
          "headersExpression": "headers.getValuesMap()"
        },{
          "type": "FreeFormAction",
          "action": "collector().session().assertComplete()"
        }]
      }]
    }
  }
}