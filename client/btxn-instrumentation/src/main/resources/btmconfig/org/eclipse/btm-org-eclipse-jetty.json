{
  "instrumentation": {
    "org.eclipse.jetty": {
      "description": "Eclipse Jetty instrumentation",
      "rules": [{
        "ruleName": "Eclipse Jetty Consumer Start",
        "className": "org.eclipse.jetty.server.handler.HandlerWrapper",
        "methodName": "handle",
        "parameterTypes": [
          "java.lang.String",
          "org.eclipse.jetty.server.Request",
          "javax.servlet.http.HttpServletRequest",
          "javax.servlet.http.HttpServletResponse"
        ],
        "location": "ENTRY",
        "condition": "activate($3.getRequestURL().toString(),$3.getHeader(\"Hawkular-btid\"))",
        "actions": [{
          "type": "SetName",
          "nameExpression": "$3.getHeader(\"Hawkular-btname\")"
        },{
          "type": "InstrumentConsumer",
          "direction": "Request",
          "endpointTypeExpression": "\"HTTP\"",
          "uriExpression": "$3.getRequestURL().toString()",
          "idExpression": "$3.getHeader(\"Hawkular-btid\")"
        },{
          "type": "ProcessContent",
          "direction": "Request",
          "headersExpression": "getHeaders(\"javax.servlet.http.HttpServletRequest\",$3)"
        },{
          "type": "SetDetail",
          "name": "btm_source",
          "valueExpression": "\"org.eclipse.jetty\""
        },{
          "type": "SetDetail",
          "name": "principal",
          "valueExpression": "$3.getRemoteUser()"
        },{
          "type": "SetDetail",
          "name": "remoteAddr",
          "valueExpression": "$3.getRemoteAddr()"
        },{
          "type": "SetDetail",
          "name": "remoteHost",
          "valueExpression": "$3.getRemoteHost()"
        }]
      },{
        "ruleName": "Eclipse Jetty Consumer End",
        "className": "org.eclipse.jetty.server.handler.HandlerWrapper",
        "methodName": "handle",
        "parameterTypes": [
          "java.lang.String",
          "org.eclipse.jetty.server.Request",
          "javax.servlet.http.HttpServletRequest",
          "javax.servlet.http.HttpServletResponse"
        ],
        "location": "EXIT",
        "condition": "isActive()",
        "actions": [{
          "type": "InstrumentConsumer",
          "direction": "Response",
          "endpointTypeExpression": "\"HTTP\"",
          "uriExpression": "$3.getRequestURL().toString()"
        },{
          "type": "AssertComplete"
        }]
      }]
    }
  }
}