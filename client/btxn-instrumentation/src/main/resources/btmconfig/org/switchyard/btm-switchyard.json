{
  "instrumentation": {
    "org.switchyard": {
      "description": "SwitchYard instrumentation",
      "rules": [{
        "ruleName": "SwitchYard Service Start",
        "className": "^org.switchyard.runtime.event.ExchangeInitiatedEvent",
        "methodName": "<init>",
        "parameterTypes": [
          "org.switchyard.Exchange"
        ],
        "location": "ENTRY",
        "condition": "collector().session().activate($1.getConsumer().getName())",
        "actions": [{
          "type": "InstrumentService",
          "direction": "Request",
          "uriExpression": "$1.getConsumer().getName()",
          "headersExpression": "getHeaders(\"org.switchyard.Context\",$1.getMessage().getContext())",
          "operationExpression": "$1.getContract().getConsumerOperation().getName()"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"btm_source\",\"org.switchyard\")"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"internal\",\"\"+!$1.getConsumer().getServiceMetadata().getRegistrant().isBinding())"
        }]
      },{
        "ruleName": "SwitchYard Service End",
        "className": "^org.switchyard.runtime.event.ExchangeCompletionEvent",
        "methodName": "<init>",
        "parameterTypes": [
          "org.switchyard.Exchange"
        ],
        "location": "ENTRY",
        "condition": "collector().session().isActive()",
        "actions": [{
          "type": "InstrumentService",
          "direction": "Response",
          "uriExpression": "$1.getConsumer().getName()",
          "headersExpression": "getHeaders(\"org.switchyard.Context\",$1.getMessage().getContext())",
          "operationExpression": "$1.getContract().getConsumerOperation().getName()"
        }]
      }]
    }
  }
}