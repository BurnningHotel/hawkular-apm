{
  "instrumentation": {
    "org.jboss.resteasy": {
      "description": "JBoss RESTEasy Client instrumentation",
      "rules": [{
        "ruleName": "JBoss RESTEasy Client Producer Start",
        "interfaceName": "^org.jboss.resteasy.client.jaxrs.ClientHttpEngine",
        "methodName": "invoke",
        "parameterTypes": [
          "org.jboss.resteasy.client.jaxrs.internal.ClientInvocation"
        ],
        "location": "ENTRY",
        "binds": [{
          "name": "id",
          "type": "java.lang.String",
          "expression": "createUUID()"
        }],
        "condition": "activate($1.getUri().toString())",
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Request",
          "endpointTypeExpression": "\"HTTP\"",
          "uriExpression": "$1.getUri().toString()",
          "idExpression": "id"
        },{
          "type": "ProcessHeaders",
          "direction": "Request",
          "originalType": "org.jboss.resteasy.client.jaxrs.internal.ClientInvocation",
          "headersExpression": "$1"
        },{
          "type": "SetDetail",
          "name": "btm_source",
          "valueExpression": "\"org.jboss.resteasy\""
        },{
          "type": "SetDetail",
          "name": "http_method",
          "valueExpression": "$1.getMethod()"
        },{
          "type": "FreeFormAction",
          "action": "$1.getHeaders().header(\"Hawkular-btid\",id)"
        },{
          "type": "FreeFormAction",
          "action": "$1.getHeaders().header(\"Hawkular-btname\",getBusinessTransactionName())"
        }]
      },{
        "ruleName": "JBoss RESTEasy Client Producer Write Entity",
        "interfaceName": "^org.jboss.resteasy.client.jaxrs.ClientHttpEngine",
        "methodName": "invoke",
        "parameterTypes": [
          "org.jboss.resteasy.client.jaxrs.internal.ClientInvocation"
        ],
        "location": "ENTRY",
        "condition": "isActive() && isRequestContentProcessed() && $1.getEntity() != null",
        "actions": [{
          "type": "ProcessContent",
          "direction": "Request",
          "valueExpressions": [
            "$1.getEntity().toString().getBytes()"
          ]
        }]
      },{
        "ruleName": "JBoss RESTEasy Client Producer getInputStream",
        "className": "org.jboss.resteasy.client.jaxrs.internal.ClientResponse",
        "methodName": "getInputStream",
        "parameterTypes": [
        ],
        "location": "EXIT",
        "condition": "isActive() && isResponseContentProcessed()",
        "actions": [{
          "type": "FreeFormAction",
          "action": "$! = createResponseInputStream($!)"
        }]
      },{
        "ruleName": "JBoss RESTEasy Client Producer Fault",
        "notes": [
          "TODO: Currently not providing a fault description due to issue calling static method HWKBTM-151"
        ],
        "className": "org.jboss.resteasy.client.jaxrs.internal.ClientResponse",
        "methodName": "close",
        "parameterTypes": [
        ],
        "location": "ENTRY",
        "condition": "isActive() && $0.getStatus() != 200",
        "actions": [{
          "type": "SetFault",
          "nameExpression": "$0.getStatus()"
        }]
      },{
        "ruleName": "JBoss RESTEasy Client Producer Close",
        "className": "org.jboss.resteasy.client.jaxrs.internal.ClientResponse",
        "methodName": "close",
        "parameterTypes": [
        ],
        "location": "ENTRY",
        "condition": "isActive()",
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Response",
          "endpointTypeExpression": "\"HTTP\""
        }]
      }]
    }
  }
}