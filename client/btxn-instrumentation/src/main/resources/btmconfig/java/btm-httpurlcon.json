{
  "instrumentation": {
    "java.net": {
      "description": "Java HttpUrlConnection instrumentation",
      "rules": [{
        "ruleName": "Java HttpUrlConnection connect Producer Start",
        "className": "^java.net.HttpURLConnection",
        "methodName": "connect",
        "parameterTypes": [
        ],
        "location": "ENTRY",
        "condition": "collector().session().activate($0.getURL().toString()) && $0.getRequestProperty(\"Hawkular-btid\") == null",
        "binds": [{
          "name": "id",
          "type": "java.lang.String",
          "expression": "createUUID()"
        }],
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Request",
          "endpointTypeExpression": "\"HTTP\"",
          "uriExpression": "$0.getURL().toString()",
          "idExpression": "id",
          "headersExpression": "$0.getRequestProperties()"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"btm_source\",\"java.net\")"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"http_method\",$0.getRequestMethod())"
        },{
          "type": "FreeFormAction",
          "action": "$0.setRequestProperty(\"Hawkular-btid\",id)"
        },{
          "type": "FreeFormAction",
          "action": "$0.setRequestProperty(\"Hawkular-btname\",collector().getName())"
        }]
      },{
        "ruleName": "Java HttpUrlConnection getOutputStream Producer Start",
        "className": "^java.net.HttpURLConnection",
        "methodName": "getOutputStream",
        "parameterTypes": [
        ],
        "location": "ENTRY",
        "condition": "collector().session().activate($0.getURL().toString()) && $0.getRequestProperty(\"Hawkular-btid\") == null",
        "binds": [{
          "name": "id",
          "type": "java.lang.String",
          "expression": "createUUID()"
        }],
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Request",
          "endpointTypeExpression": "\"HTTP\"",
          "uriExpression": "$0.getURL().toString()",
          "idExpression": "id",
          "headersExpression": "$0.getRequestProperties()"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"btm_source\",\"java.net\")"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"http_method\",$0.getRequestMethod())"
        },{
          "type": "FreeFormAction",
          "action": "$0.setRequestProperty(\"Hawkular-btid\",id)"
        },{
          "type": "FreeFormAction",
          "action": "$0.setRequestProperty(\"Hawkular-btname\",collector().getName())"
        }]
      },{
        "ruleName": "Java HttpUrlConnection getInputStream Producer Start",
        "className": "^java.net.HttpURLConnection",
        "methodName": "getInputStream",
        "parameterTypes": [
        ],
        "location": "ENTRY",
        "condition": "collector().session().activate($0.getURL().toString()) && $0.getRequestProperty(\"Hawkular-btid\") == null",
        "binds": [{
          "name": "id",
          "type": "java.lang.String",
          "expression": "createUUID()"
        }],
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Request",
          "endpointTypeExpression": "\"HTTP\"",
          "uriExpression": "$0.getURL().toString()",
          "idExpression": "id",
          "headersExpression": "$0.getRequestProperties()"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"btm_source\",\"java.net\")"
        },{
          "type": "FreeFormAction",
          "action": "collector().setDetail(\"http_method\",$0.getRequestMethod())"
        },{
          "type": "FreeFormAction",
          "action": "$0.setRequestProperty(\"Hawkular-btid\",id)"
        },{
          "type": "FreeFormAction",
          "action": "$0.setRequestProperty(\"Hawkular-btname\",collector().getName())"
        }]
      },{
        "ruleName": "Java HttpUrlConnection Producer End",
        "className": "^java.net.HttpURLConnection",
        "methodName": "connect",
        "parameterTypes": [
        ],
        "location": "EXIT",
        "condition": "collector().session().isActive()",
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Response",
          "endpointTypeExpression": "\"HTTP\"",
          "uriExpression": "$0.getURL().toString()"
        }]
      }]
    }
  }
}